<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="../student/css/pteTest.css">


    <script>
      $(document).ready(function () {
      $('#addEmployee').click(function(){
           $('#main').load('employeeAdd.html');
      });
      $('#batchAdd').click(function(){
           $('#main').load('batchView.html');  
      });
      $('#wallet').click(function(){
           $('#main').load('wallet.html');
      });
      $('#studentView').click(function(){
           $('#main').load('studentView.html');
      });
      $('#studentAttendance').click(function(){
           $('#main').load('studentAttendance.html');
      });
      $('#assTest').click(function(){
           $('#main').load('assignTest.html');
      });
      $('#assVideo').click(function(){
           $('#main').load('assignVideo.html');
      });
      $('#pendingEvaluation').click(function(){
           $('#main').load('evaluationPending.html');
      });
      $('#evaluationHistory').click(function(){
           $('#main').load('evaluationHistory.html');
      });
      $('#employeeView').click(function(){
           $('#main').load('employeeView.html');
      });
      $('#employeeAttendance').click(function(){
           $('#main').load('employeeAttendance.html');
      });
      $('#ticket').click(function(){
           $('#main').load('support.html');
      });
      });
    </script>
    <script>
      $(document).ready(function () {
          
          $('.dropdown').click(function () {
              const $submenu = $(this).find('.submenu');

              $submenu.slideToggle();
  
              $('.dropdown').not(this).find('.submenu').slideUp();

               event.stopPropagation();
          });

          $('.submenu').click(function (event) {
              event.stopPropagation();
          });
      });
  </script>

 
</head>
<body style="cursor: context-menu;" id="main-content">
  <nav id="main-navbar" class="navbar1 fixed-top" style="position: fixed;">
    <a id="toggle-btn" href="javascript:void(0);" onclick="" class="link-dark">
        <img class="logo_icon" src="images/LMS_icon.png" />
        <div href="" class="logo_name text-decoration-none"><span>PTE EXAM LMS</span></div>
        <div class="logout profile-dropdown-box m-4 me-4" style="float: right;">
          <h6 id="logout" class="h5 fw-light" style="cursor: pointer;">logout</h6>
        </div>

    </a>
  </nav>
 
  <div class="sidebar">
    <ul class="menu">
      <li class="menu-item">
        <a href="#" class="text-decoration-none mt-2"><img class="icon me-4" src="images/dashboard.png" />Dashboard</a>
      </li>
      <li class="menu-item dropdown">
        <a href="#" class="text-decoration-none"><img class="icon me-4" src="images/Admin.png" />Admin</a>
        <ul class="submenu">
          <li><a href="#" id="addEmployee" class="text-decoration-none">Add Empolyee</a></li>
          <li><a href="#" id="batchAdd" class="text-decoration-none">Batch</a></li>
          <li><a href="#" id="wallet" class="text-decoration-none">Wallet</a></li>
        </ul>
      </li>
      <li class="menu-item dropdown">
        <a href="#" class="text-decoration-none"><img class="icon me-4" src="images/student.png" />Student</a>
        <ul class="submenu">
          <li><a id="studentView" href="#" class="text-decoration-none">View</a></li>
          <li><a id="studentAttendance" href="#" class="text-decoration-none">Attendance</a></li>
        </ul>
      </li>
      <li class="menu-item dropdown">
        <a href="#" class="text-decoration-none"><img class="icon me-4" src="images/programs.png" />Program PTE</a>
        <ul class="submenu">
          <li><a id="assTest" href="#" class="text-decoration-none">Assign Test</a></li>
          <li><a href="#" id="pendingEvaluation" class="text-decoration-none">Pending Evaluation</a></li>
          <li><a href="#" id="evaluationHistory" class="text-decoration-none">Evaluation History</a></li>
          <li><a id="assVideo" href="#" class="text-decoration-none">Assign Videos</a></li>
        </ul>
      </li>
      <li class="menu-item dropdown">
        <a href="#" class="text-decoration-none"><img class="icon me-4" src="images/employee.png" />Employee</a>
        <ul class="submenu">
          <li><a id="employeeView" href="#" class="text-decoration-none">View</a></li>
          <li><a id="employeeAttendance" href="#" class="text-decoration-none">Attendance</a></li>
        </ul>
      </li>
      <li class="menu-item dropdown">
        <a href="#" class="text-decoration-none"><img class="icon me-4" src="images/support.png" />Support</a>
        <ul class="submenu">
          <li><a id="ticket" href="#" class="text-decoration-none">Ticket</a></li>
        </ul>
      </li>
    </ul>
    
  
  </div>
  <div id="main">
    
  </div>
  <div id="popup" class="popup">
    <div class="popup-card" style="width: 30rem;">
      <div class="card-body">
        <h5 class="card-title-logout"></h5>
          <p class="card-text-logout"></p>
        <div class="btn-section"></div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#logout').click(function(e){
          $('.btn-section').empty()
          $("#popup").fadeIn();
          $('.card-title-logout').text('Log Out')
          $('.card-title-logout').css('font-weight', 'bold')
          $('.card-text-logout').text('Are you sure you want to log-off?')
          $('.btn-section').append(`
              <a id="btn-logout" href="#"  class="btn btn-primary float-center me-3">logout</a>
              <a id="btn-cancel" href="#" data-recording = 1  class="btn btn-outline-primary float-center me-3">cancel</a>
          `)
      })

      $(document).on('click', '#btn-logout', function(e){
        $("#popup").fadeOut();
        window.location.href = "../logout.php?type=student";
      });

      $(document).on('click', '#btn-cancel', function(e){
          $("#popup").fadeOut();
      });
    }); 
  </script>
  <script>
    $(document).ready(function() {
        const toggleBtn = $("#toggle-btn");
        const sidebar = $(".sidebar");

        toggleBtn.click(function() {
            sidebar.toggleClass("open");
        });
    });
  </script>
  <script>
    $(document).ready(function () {
        // Add click event handling using jQuery
        $('.text-decoration-none').click(function () {
            // Remove 'clicked' class from all list items
            $('.text-decoration-none').removeClass('clicked');

            // Add 'clicked' class to the clicked list item
            $(this).addClass('clicked');
        });
    });
</script>
<script>
  document.querySelector('.icon').addEventListener('click', function() {
    var dropdown = document.querySelector('.dropdown-content-profile');
    if (dropdown.style.display === 'none' || dropdown.style.display === '') {
        dropdown.style.display = 'block';
    } else {
        dropdown.style.display = 'none';
    }
  });

  function logout() {
    // Add logout functionality here, such as redirecting to a logout endpoint or clearing session data.
    alert('Logout button clicked!');
  }

 </script>

<script>
      let timeout;

      function checkLoginStatus() {
            $.ajax({
                type: "GET",
                url: "dataHandler/api/get.php?data_type=check_login", // Create this PHP file
                success: function (data) {
                    if (data === "success") {
                        // User is logged in, do nothing
                    } else {
                        window.location.href = "login.html"; // Redirect to the login page
                    }
                }
            });
        }

        // Event listener to check login status on page load
        $(document).ready(function () {
            checkLoginStatus();
        });



      // Function to reset the timer
      function resetTimeout() {
          clearTimeout(timeout);
          timeout = setTimeout(function () {
              logoutUser();
          }, 30* 60* 1000 ); // 30 minute (30 * 60 * 1000 milliseconds)
      }

      // Function to initiate logout
      function logoutUser() {
          $.ajax({
              type: "GET",
              url: "dataHandler/api/get.php?data_type=logout",
              success: function (data) {
                    if (data === "success") {
                        window.location.href = "login.html"; // Redirect to the login page
                    } else {
                        alert("Logout failed.");
                    }
                }
          });
      }

      // Event listener to reset the timer on user activity
      $(document).on('click mousemove', function () {
          resetTimeout();
      });

      // Initial timer start
      resetTimeout();

      // Click event for the logout button
      $("#logoutButton").click(function () {
          logoutUser();
      });
</script>
<script>
  var notificationsVisible = false;
  
  $(document).ready(function () {
      notifyCount = $('#button-show-simple')
      function notification_count(count){
          var htmlToInsertNotificationCount = `
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              +${count}
                    <span class="visually-hidden">unread messages</span>
            </span>
              `;

          var count = $(htmlToInsertNotificationCount);
          notifyCount.append(count);
      }


      $.ajax({
            type: 'GET',
            url: 'dataHandler/api/get.php?data_type=notification',
            dataType: "json",
            success: function(data){
              console.log(data.length);
              var dataLength = data.length;
              notification_count(dataLength);  
            }
      })
    })

    $(document).on("click", "#button-show-simple", function() {
      
      var notifyArea = $('#notifyArea');
      
      function insertAlert(message, type, id) {
          console.log(id)
          var htmlToInsert = `
              <div class="alert alert-primary" role="alert" style = "margin-bottom: 5px; max-width: 550px;">
                <button type="button" data-id=${id}  class="close" data-dismiss="alert" aria-label="Close" style = "margin-left: 15px">
                  <span aria-hidden="true">&times;</span>
                </button>
                <b>${type}</b>  -  ${message}
              </div>
          `;

          
          var newAlert = $(htmlToInsert);
          newAlert.hide();
          notifyArea.append(newAlert);
          newAlert.fadeIn(500); // Fade in the new notification
      }
      

      if (notificationsVisible) {
          // Hide and remove existing notifications
          notifyArea.children().fadeOut(500, function() {
              $(this).remove();
          });
          notificationsVisible = false;
      } else {
          $.ajax({
            type: 'GET',
            url: 'dataHandler/api/get.php?data_type=notification',
            dataType: "json",
            success: function(data){
              console.log(data.length)
              var dataLength = data.length
              $.each(data, function(index, item){
                console.log(item.id);
                insertAlert(item.message, item.type, item.id);
              })
            }
          })
          notificationsVisible = true;
      }
    });

  $(document).on("click", ".close", function() {
    notifyCount = $('#button-show-simple')
    function notification_count(count){
      var htmlToInsertNotificationCount = `
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
          +${count}
          <span class="visually-hidden">unread messages</span>
        </span>
        `;

      var count = $(htmlToInsertNotificationCount);
      notifyCount.append(count);
    }
    var id = $(this).data('id');
    $(this).parent().fadeOut(500, function() {
      console.log(id)
      $(this).remove();
      $.ajax({
        type: "POST",
        url: "dataHandler/api/post.php", // Replace with the URL of your PHP script
        data: { itemId: id, task: 'removeNotification' },
        success: function(response) {
          console.log("Test " + testId + " removed");
        },
      })
      $.ajax({
            type: 'GET',
            url: 'dataHandler/api/get.php?data_type=notification',
            dataType: "json",
            success: function(data){
              console.log(data.length);
              var dataLength = data.length;
              notification_count(dataLength);  
            }
      })
    });
  });
</script>

</body>
</html>