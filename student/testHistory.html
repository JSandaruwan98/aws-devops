<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mock_exams.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/pteTest.css">
   
  
</head>
<body>
    <div class="header border" style="border-radius: 12px; background: lightgray url(images/item2.png) 0px -52.475px / 100% 190.82% no-repeat; height: 100px;">
        <div></div>
    </div>

    

    <div id="mock-test" class="row">
        <h1 class="h4 ms-4 mt-5">Test History</h1>
        <ul class="nav nav-pills" style="margin: 20px 0px 20px 40px;">
            <li class="nav-item">
              <a id="tab-1" class="nav-link active" aria-current="page" href="#">Full Test</a>
            </li>
            <li class="nav-item">
              <a id="tab-2" class="nav-link" href="#">Session Test</a>
            </li>
        </ul>
        <div id="tab-content">
            <div class="border p-4" id="session-content"  style="display:none; margin: 0px 40px 30px 40px; border-radius: 5px;"></div>
            <div id="tab-content-complete"></div>
        </div>
    </div>


    <div id="popup" class="popup">
        <div class="popup-card" style="width: 30rem;">
            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text"></p>
                <div class="btn-section"></div>
            </div>
        </div>
    </div> 

<script>
    $(document).ready(function(){
        

              

        /**##############################################################################
        *                   Pending Test Data fetching Function
        * ##############################################################################**/

        function loadCompleteData(category){
            $('#tab-content-complete').empty()
            $.ajax({
                type: "GET",
                url: "src/controllers/getController.php?data_type=completeTest&category="+category,
                data: {  },
                dataType: "json",
                success: function (response) {
                    $.each(response, function (index, item) {
                        $('#tab-content-complete').append(`
                        <div id="exam-division" class="exam-division-complete row" style="padding: 5px 60px;">
                            <div class="col-12">
                                <div class="card" style = " cursor: pointer;"  data-id = `+item.test_id+` data-eval = `+item.evaluated+` >
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-1 d-flex align-items-center px-4">
                                                <img id="exam-profile-img-1" class="rounded-circle shadow-1-strong"
                                                src="`+item.image_file+`" alt="avatar" width="60"
                                                height="60" />
                                            </div>
                                            <div class="col-9 d-flex align-items-center px-4">
                                                <div id="user-name-1" class="col-6 fw-bold text-primary">`+item.name+`</div>
                                            </div>    
                                            <div class="col-2 d-flex align-items-center">
                                                <div id="user-name-1" class="fw-bold text-primary text-end">`+item.attempted_on+`</div>
                                            </div>   
                                        </div> 
                                    </div>
                                </div>
                            </div>
                        </div>
                        `)
                    })


                    $('.card').click(function (e) {
                        var eval = $(this).data('eval')
                        if(eval){
                            var url = "index.php?url=/Evaluation#" + $(this).data('id');
                            var newTab = window.open('', '_blank');

                            newTab.location.href = url;
                        }else{
                            $('.btn-section').empty()
                            $("#popup").fadeIn();
                            $('.card-text').text('This has not been evaluated')
                            $('.btn-section').append(`
                                <a id="close" href="#"  class="btn btn-primary float-center me-3">Close</a>
                            `)

                            $('#close').on('click', function() {
                                $("#popup").fadeOut();
                            });
                        }
                        
                    })

                    

                    
                    

                },error: function() {
                    $('#tab-content-complete').empty()
                    $('#tab-content-complete').append(`
                        <div id="exam-division" class="exam-division-pending row" style="padding: 5px 60px;">
                            <p class="text-secondary">Aren't into the Content.</p>
                        </div>
                        `)
                    console.log('asaa')
                }
            })
        }

        
        /**##############################################################################
        *                           Session Test Content Buttons
        * ##############################################################################**/


        function sessionContentBTN(){
            var topics = ["Speaking", "Writing", "Reading", "Listening"];

            var contentDiv = $("#session-content");
            contentDiv.empty()
            loadCompleteData("Speaking")

            for (var i = 0; i < topics.length; i++) {
                $('#Speaking').addClass('active')

                var button = $("<div></div>").addClass("col-3 text-center");
                var innerDiv = $("<div></div>").attr("data-tab", topics[i]).css({"width": "200px", "height": "30px", "font-size": "10px", "border": "1px solid"});
                innerDiv.addClass("btn-outline-primary tab-a1 pronun btn").attr("id", topics[i]).text(topics[i]);
                
                

                innerDiv.click(function() {
                    $('#Speaking, #Writing, #Reading, #Listening').removeClass("active");
                    $('#'+$(this).attr("data-tab")).toggleClass('active')
                    loadCompleteData($(this).attr("data-tab"))
                                        
                });

                button.append(innerDiv);
                contentDiv.append(button);

            }

            
            

        }

        
        loadCompleteData('All')

        

        $('#tab-1').click(function() {
            $(this).addClass('active')
            $('#tab-2').removeClass('active')
            $('#tab-3').removeClass('active')
            $('#session-content').css('display','none')
            loadCompleteData('All')

        });

        $('#tab-2').click(function() {
            $(this).addClass('active')
            $('#tab-3').removeClass('active')
            $('#tab-1').removeClass('active')  
            $('#session-content').addClass('row') 
            $('#session-content').css('display','flex')
            sessionContentBTN()
        });

        $('#tab-3').click(function() {
            $(this).addClass('active')
            $('#tab-2').removeClass('active')
            $('#tab-1').removeClass('active')  
            $('#tab-content-complete').empty() 
            $('#session-content').css('display','none') 
        });

    })
</script>   
</body>
</html>